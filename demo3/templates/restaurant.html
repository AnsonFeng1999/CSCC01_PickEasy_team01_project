{% extends "base.html" %}

{% block title %}
<title>{{ rname }}</title>
{% endblock title %}

{% block style %}
<link rel="stylesheet" type="text/css" href="static/restaurant.css">
<link rel="stylesheet" type="text/css" href="static/sidebar.css">
<link rel="stylesheet" type="text/css" href="static/milestone.css">
{% endblock style %}

{% block sidebar %}
<div class="sidenav">
  <div class = side_title>
    {{ rname }}
  </div>
  <a href="restaurant{{ rid }}">
    <div class = but>
      <button type="button">
        <img src="static/Resources/home_pressed.png" alt="Coupon">
        Home
      </button>
    </div>
  </a>
  <a href="couponOffers{{ rid }}">
    <div class = but>
      <button type="button">
        <img src="static/Resources/coupon_pressed.png" alt="Coupon" class = coupon>
        Coupon Offers
      </button>
    </div>
  </a>
  <a href="availableAchievements{{ rid }}">
    <div class = but>
      <button type="button">
        <img src="static/Resources/achievement_pressed.png" alt="Achievement">
        Achievement Offers
      </button>
    </div>
  </a>
  <a href="milestones{{ rid }}">
    <div class = but>
      <button type="button">
        <img src="static/Resources/flag.png" alt="Milestones">
        Milestones
      </button>
    </div>
  </a>
</div>
{% endblock sidebar %}

{% block page_name %}
    <div class = parent>
      <div class = title>
        <div class = text>
          {{ rname }}
        </div>
        <div class = love>
          {% if liked %}
          <form method = "post">
            <input type="image" src="static/Resources/heart_pink.png" alt="loved">
            <input type="hidden" name = "unloved">
          </form>
          {% else %}
          <form method = "post">
            <input type="image" src="static/Resources/heart.png" alt="unloved">
            <input type="hidden" name = "loved">
          </form>
          {% endif %}
        </div>
      </div>
    </div>
{% endblock page_name %}

{% block content %}
      <div class = parent>
      <div class = title>
        <div class = level_title>
          Your Customer Level:
        </div>
        <div class = level>
          Level {{ level }}
        </div>
      </div>
      <progress value="{{ overflow }}" max="{{ (level + 1) * 100 }}">
        ({{ overflow }} / {{ (level + 1) * 100 }} * 100)%
      </progress>
      <div class = level_progress>
        <div class = progress_count>
          {{ overflow }}
        </div>
        <div class = progress_count_total>
          /{{ (level + 1) * 100 }}
        </div>
        <div class = progress_text>
          EXP to Level {{ level + 1 }}
        </div>
      </div>
      <div class = fine_print>
        {% if milestone %}
          Reach level {{ milestone["level"] }} and gain {{ milestone["reward"] }} points.
        {% endif %}
      </div>
    </div>

      <div class = parent>
        <div class = title>
          <div class = text>
            Recent Coupon Offers:
          </div>
        </div>
        {% for c in coupons %}
            <div class = container>
              <div class = name>
                {{ c["name"] }}
              </div>
              <div class = amount>
                Cost: {{ c["points"] }} Points
              </div>
              <div class = description>
                {{ c["description"] }}
              </div>
              <div class = expiration>
                {% if c["begin"] == None or c["expiration"] == None %}
                  Valid indefinitely
                {% else %}
                  Valid from: {{ c["begin"] }} to {{ c["expiration"] }}
                {% endif %}
              </div>
            </div>
        {% endfor %}
        <a href="couponOffers{{ rid }}">
          <div class = seeMore>
            <button type="button">
              View All Coupon Offers
            </button>
          </div>
        </a>
      </div>

      <div class = parent>
        <div class = title>
          <div class = text>
            Achievement Progress:
          </div>
        </div>
        {% for a in achievements %}
          <div class = container>
            <div class = name>
              {{ a["name"] }}
            </div>
            <div>
              {{ a["description"] }}
            </div>
            <div class = achievement_progress_bar>
              <progress value="{{ a["progress"] }}" max="{{ a["progressMax"] }}">
                ({{ a["progress"] }} / {{ a["progressMax"] }} * 100)%
              </progress>
              <div class = check>âœ”</div>
            </div>
            <div class = achievement_footer>
              <div class = achievement_progress>
                <div class = achievement_progress_text>
                  Progress:
                </div>
                <div class = progress_count>
                  {{ a["progress"] }}
                </div>
                <div class = progress_count_total>
                  /{{ a["progressMax"] }}
              </div>
              </div>
              <div class = rewards>
                <div class = number>{{ a["points"] }}</div>
                <div class = rewards_text>PT</div>
                <div class = number>{{ a["experience"] }}</div>
                <div class = rewards_text>EXP</div>
              </div>
            </div>
          </div>
        {% endfor %}
        {% if achievements|length == 0 %}
        <div class = none>
          No achievements in progress.
        </div>
        <a href="availableAchievements{{ rid }}">
          <div class = seeMore>
            <button type="button">
              View All Available Achievements
            </button>
          </div>
        </a>
        {% else %}
        <a href="inProgressAchievements{{ rid }}">
          <div class = seeMore>
            <button type="button">
              View All In-Progress Achievements
            </button>
          </div>
        </a>
        {% endif %}
      </div>

      <div class = parent>
        <div class = title>
          <div class = text>
            Next Milestones:
          </div>
        </div>
        <div class = table>
            <div class = header>
              <div class = columns>
                <div class = child>
                  Level
                </div>
                <div class = child>
                  Reward Points
                </div>
                <div class = child>
                  Status
                </div>
              </div>
            </div>

              {% for t in thresholds %}
                <div class = columns>
                    <div class = child>
                      {{ t["level"] }}
                    </div>
                    <div class = child>
                      {{ t["reward"] }} PTS
                    </div>
                    <div class = child>
                      {% if level >=  t["level"] %}
                        <div class = pink_text>
                          Completed
                        </div>
                      {% else %}
                        Incomplete
                      {% endif %}
                    </div>
                  </div>
              {% endfor %}
        </div>
        <a href="milestones{{ rid }}">
          <div class = seeMore>
            <button type="button">
              View All Milestones
            </button>
          </div>
        </a>
      </div>
  {% endblock content %}
